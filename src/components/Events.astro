<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Grid with Expanded View</title>
    <style>
        /* Modal styles */
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #modalContent {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            position: relative;
        }
        #closeModal {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 24px;
        }
        #modalImage {
            max-width: 100%;
            max-height: 300px;
            object-fit: cover;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="flex flex-col" data-type="future-events">
        <h1 class="py-5 flex text-xl font-semibold justify-center">Upcoming Events</h1>
        <div id="futureContainer" class="flex flex-col items-end">
            <div id="futureCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
                <!-- Future cards will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div class="border-b-2 w-11/12"></div>
    <br>
    <h1 class="flex text-xl font-semibold justify-center">SIBOL: Samahan ng mga Bagong Iskolar ng Salinlahi</h1>
    <br>

    <div class="flex flex-row gap-4 max-w-6xl">

        <div class="relative w-full max-w-full rounded-lg bg-white overflow-hidden">      
            <img src="../../images/sibol1.webp" class="w-full max-h-80">
            <div class="px-16 py-8 w-full max-w-full bg-white">
                <h1 class="flex text-xl font-semibold justify-center">SIBOL: NATIONAL YOUNG SCHOLARS CONFERENCE AND CONTEST</h1>
                <br>
                “21st Century Filipino Young Scholars: Responding to Social Issues Through Research”<br>
                <br>
                Last October 27-28, 2019, Lumina Foundation for Integral Human Development, Inc. (LFIHD) in cooperation with the Network of Professional Researches and Educators, Inc. (NPRE) invited young scholars from Grade 11 to First Year college to share and present their research works in Sibol: National Young Scholars Conference and Contest 2019. The research conference was held at Henann Regency Resort and Spa, Boracay, Aklan. The election of the founding officers of SIBOL: Samahan ng mga Iskolar ng Bagong Salinlahi was also held after the research conference.<br>
            </div>
        </div>
        <br>

        <div class="relative w-full max-w-full rounded-lg bg-white overflow-hidden text-sm"> 
            <img src="../../images/sibol2.webp" class="w-full max-h-80">    
            <div class="px-8 py-8 w-full max-w-full bg-white">
                <div class="flex flex-col justify-center items-center">
                    <div class="font-medium">Mr. Brent Roi Gutierrez</div>
                    <div class="font-light">(Lyceum Of The Philippines University – Batangas)</div>
                    <div class="font-semibold">President</div>
                </div>

                <br>

                <div class="flex flex-row gap-4">


                    <div class="flex flex-col justify-center items-center">
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Ms. Winter Jill G. Perlas</div>
                            <div class="font-light">(Adamson University)</div>
                            <div class="font-semibold">Vice President</div>
                        </div>
                        <br>
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Ms. Maria Angela U. Manuel</div>
                            <div class="font-light">(Lyceum Of The Philippines University – Batangas)</div>
                            <div class="font-semibold">PRO</div>
                        </div>
                        <br>
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Ms. Kryssy Alfiona R. Simon</div>
                            <div class="font-light">(Isable National High School)</div>
                            <div class="font-semibold">Luzon Representative</div>
                        </div>
                    </div>

                    <div class="flex flex-col justify-center items-center">
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Mr. Ferie E. Manuel</div>
                            <div class="font-light">(Adamson University)</div>
                            <div class="font-semibold">Secretary</div>
                        </div>
                        <br>
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Ms. Maria Angela U. Manuel</div>
                            <div class="font-light">(Manila Science High School)</div>
                            <div class="font-semibold">NCR Representative</div>
                        </div>
                        <br>
                        <div class="flex flex-col justify-center items-center">
                            <div class="font-medium">Ms. Ariana G. Gromea</div>
                            <div class="font-light">(Silay Institue)</div>
                            <div class="font-semibold">Visayas Representative</div>
                        </div>
                    </div>

                </div>
            </div> 
        </div>
        
    </div>
    <br>
    <div class="border-b-2 w-11/12"></div>


    <div class="flex flex-col" data-type="events">
        <h1 class="py-5 flex text-xl font-semibold justify-center">Archive</h1>
        <div id="container" class="flex flex-col items-end">
            <div id="cardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
                <!-- Past Cards will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Modal for expanded view -->
    <div id="modal" class="flex">
        <div id="modalContent" class="relative">
            <span id="closeModal" class="text-red-600">&times;</span>
            <img id="modalImage" src="" alt="Event Image">
            <h3 id="modalTitle" class="text-xl font-semibold"></h3>
            <p id="modalBody" class="text-gray-700 mt-2"></p>
            <p id="modalDate" class="text-gray-500 mt-2 text-sm"></p>
        </div>
    </div>

    <script>
        let collection = [];
        const container = document.querySelector('div[data-type="events"]');
        const futureContainer = document.querySelector('div[data-type="future-events"]');
        const url = '/events';

        async function fetchData() {
            try {
                const response = await fetch(url);
                if (response.ok) {
                    collection = await response.json();
                    updateCards();
                } else {
                    console.error('Failed to fetch data:', response.statusText);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function formatBody(body) {
            return body.replace(/\n/g, '<br>');
        }

        function formatDate(dateTime) {
            const date = new Date(dateTime);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long', // 'long' gives you the full month name
                day: 'numeric'
            });
        }

        function updateCards() {
            const cardsContainer = document.getElementById('cardsContainer');
            const futureCardsContainer = document.getElementById('futureCardsContainer');
            cardsContainer.innerHTML = '';
            futureCardsContainer.innerHTML = '';

            const currentDate = new Date();

            // Filter and sort the collection by date where published == 1
            const filteredCollection = collection
                .filter(item => item.published === 1) // Filter by published attribute
                .sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime)); // Sort by date

            filteredCollection.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('bg-white', 'p-0', 'rounded', 'shadow-lg', 'relative', 'w-80', 'h-full', 'cursor-pointer', 'overflow-hidden');
                card.dataset.title = item.title;
                card.dataset.body = item.body;
                card.dataset.date = item.dateTime;
                card.dataset.imageurl = item.imageurl;

                const image = document.createElement('img');
                image.classList.add('w-full', 'h-48', 'object-cover', 'mb-4');
                image.src = item.imageurl; // Fallback image URL

                const title = document.createElement('h3');
                title.classList.add('text-xl', 'font-semibold', 'px-4');
                title.textContent = item.title;

                const date = document.createElement('p');
                date.classList.add('text-gray-500', 'text-sm', 'px-4', 'pb-4');
                date.textContent = formatDate(item.dateTime) || 'No date available'; // Fallback text

                card.appendChild(image);
                card.appendChild(title);
                card.appendChild(date);
                card.addEventListener('click', () => showModal(item));

                const itemDate = new Date(item.dateTime);
                if (itemDate > currentDate) {
                    futureCardsContainer.appendChild(card);
                } else {
                    cardsContainer.appendChild(card);
                }
            });
        }

        function showModal(item) {
            document.getElementById('modalTitle').textContent = item.title;
            document.getElementById('modalBody').innerHTML = formatBody(item.body);
            document.getElementById('modalDate').textContent = formatDate(item.dateTime) || 'No date available'; // Fallback text
            document.getElementById('modalImage').src = item.imageurl;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        document.getElementById('closeModal').addEventListener('click', closeModal);

        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            setInterval(fetchData, 5000);
        });
    </script>
</body>
</html>
